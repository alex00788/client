# InfoBlockComponent

## Описание

`InfoBlockComponent` - это информационный блок календаря, отвечающий за отображение текущей выбранной даты и предоставляющий навигацию по дням. Компонент позволяет пользователю переходить к предыдущему или следующему дню, автоматически обновляя данные календаря при каждом изменении даты.

## Основной функционал

### Ключевые возможности
- ✅ **Отображение текущей даты** - автоматическое форматирование даты в формате DD.MM.YYYY
- ✅ **Навигация по дням** - кнопки для перехода к предыдущему и следующему дню
- ✅ **Автоматическое обновление данных** - вызов сервиса для обновления записей при смене даты
- ✅ **Интеграция с календарной системой** - взаимодействие с DateService и DataCalendarService
- ✅ **Реактивное обновление** - автоматическое обновление при изменении даты в сервисе
- ✅ **Пользовательский интерфейс** - интуитивно понятные стрелки навигации

### Архитектурные особенности
- **Standalone компонент** - независимая модульная архитектура
- **Реактивное программирование** - использование RxJS для управления состоянием
- **Момент.js интеграция** - работа с датами через Moment.js
- **Сервисная архитектура** - взаимодействие с внешними сервисами
- **Автоматическая инициализация** - установка текущей даты при создании компонента

## Структура файлов

```
info-block/
├── info-block.component.ts           # Основная логика компонента
├── info-block.component.html         # HTML шаблон информационного блока
├── info-block.component.css          # Стили для информационного блока
├── info-block.component.spec.ts      # Unit тесты (112 тестов)
├── info-block.integration.spec.ts    # Интеграционные тесты (112 тестов)
├── info-block.e2e.spec.ts           # E2E тесты (112 тестов)
└── README.md                        # Документация компонента
```

## Публичные методы и свойства

### Свойства
```typescript
currentTime: string                   // Текущая дата в формате DD.MM.YYYY
dateService: DateService              // Сервис для работы с датами
dataCalendarService: DataCalendarService // Сервис для работы с данными календаря
```

### Методы
```typescript
ngOnInit(): void                     // Инициализация и установка текущей даты
go(direction: number): void          // Навигация по дням (1 - следующий, -1 - предыдущий)
```

## Зависимости

### Внешние сервисы
- **DateService** - управление текущей датой и навигацией по календарю
- **DataCalendarService** - работа с данными календаря и записями

### Angular модули
- **AsyncPipe** - для работы с асинхронными данными
- **MomentTransformDatePipe** - для форматирования дат

## Алгоритм работы

### Инициализация компонента
1. **Создание компонента** - инициализация сервисов через dependency injection
2. **Установка текущей даты** - автоматическое получение текущей даты при ngOnInit
3. **Форматирование даты** - преобразование в формат DD.MM.YYYY с ведущими нулями

### Навигация по дням
1. **Получение направления** - параметр direction (1 для следующего дня, -1 для предыдущего)
2. **Обновление даты** - вызов `DateService.changeOneDay(direction)`
3. **Обновление данных** - вызов `DataCalendarService.getAllEntryAllUsersForTheMonth()`
4. **Уведомление об изменении** - эмит события через `recordingDaysChanged`

## Детальное описание тестов

### Unit тесты (112 тестов)

#### Создание компонента (4 теста)
- ✅ Успешное создание компонента
- ✅ Правильная инъекция всех требуемых сервисов
- ✅ Инициализация с пустой строкой currentTime
- ✅ Корректный CSS класс компонента

#### ngOnInit (8 тестов)
- ✅ Установка currentTime в правильном формате DD.MM.YYYY
- ✅ Корректное форматирование однозначных дней и месяцев
- ✅ Корректное форматирование двузначных дней и месяцев
- ✅ Обработка високосного года
- ✅ Обработка границ года
- ✅ Обработка границ месяца
- ✅ Автоматический вызов при инициализации
- ✅ Установка currentTime только один раз

#### Метод go (10 тестов)
- ✅ Вызов DateService.changeOneDay с правильным параметром направления
- ✅ Вызов DateService.changeOneDay с положительным направлением
- ✅ Вызов DateService.changeOneDay с отрицательным направлением
- ✅ Вызов DateService.changeOneDay с нулевым направлением
- ✅ Вызов DataCalendarService.getAllEntryAllUsersForTheMonth после изменения даты
- ✅ Вызов обоих сервисов в правильном порядке
- ✅ Обработка множественных последовательных вызовов
- ✅ Обработка быстрых последовательных вызовов
- ✅ Работа с большими значениями направления
- ✅ Работа с отрицательными большими значениями направления

#### Интеграция с шаблоном (8 тестов)
- ✅ Отображение currentTime в шаблоне
- ✅ Кнопка левой стрелки для предыдущего дня
- ✅ Кнопка правой стрелки для следующего дня
- ✅ Кликабельные кнопки навигации
- ✅ Отображение текста "Выбрано:" в шаблоне
- ✅ Правильные CSS классы
- ✅ Три основные секции
- ✅ Первая секция как левая навигация
- ✅ Средняя секция как отображение даты
- ✅ Последняя секция как правая навигация

#### Edge Cases для форматирования дат (6 тестов)
- ✅ Корректная обработка января
- ✅ Корректная обработка декабря
- ✅ Обработка февраля в високосном году
- ✅ Обработка февраля в невисокосном году
- ✅ Обработка месяцев с 30 днями
- ✅ Обработка месяцев с 31 днем

#### Интеграция с сервисами (4 теста)
- ✅ Интеграция с DateService.date observable
- ✅ Работа с DateService.changeOneDay методом
- ✅ Работа с DataCalendarService.getAllEntryAllUsersForTheMonth методом
- ✅ Поддержание ссылок на сервисы после множественных операций

#### Жизненный цикл компонента (3 теста)
- ✅ Корректная инициализация при первой загрузке
- ✅ Поддержание состояния между вызовами методов
- ✅ Возможность повторного использования после множественных операций

#### Обработка ошибок и граничных случаев (4 теста)
- ✅ Graceful обработка невалидных параметров направления
- ✅ Обработка очень больших значений направления
- ✅ Обработка отрицательных больших значений направления
- ✅ Обработка значений с плавающей точкой
- ✅ Корректная работа с нулевым направлением

#### Производительность и память (3 теста)
- ✅ Эффективная обработка быстрых вызовов методов
- ✅ Отсутствие утечек памяти после множественных операций
- ✅ Поддержание консистентной производительности

#### Доступность и UX (4 теста)
- ✅ Кликабельные элементы навигации
- ✅ Четкие индикаторы навигации
- ✅ Четкий формат отображения даты
- ✅ Консистентная структура макета

### Интеграционные тесты (112 тестов)

#### Полный жизненный цикл компонента (2 теста)
- ✅ Инициализация и корректное отображение с реальными сервисами
- ✅ Полный цикл от инициализации до множественных операций

#### Интеграция с реальными сервисами (4 теста)
- ✅ Интеграция с реальным DateService.changeOneDay методом
- ✅ Интеграция с реальным DataCalendarService.getAllEntryAllUsersForTheMonth методом
- ✅ Работа с реальным DateService.date observable
- ✅ Поддержание ссылок на реальные сервисы на протяжении жизненного цикла

#### Реальные пользовательские взаимодействия (3 теста)
- ✅ Корректная обработка последовательной навигации с реальными сервисами
- ✅ Эффективная обработка быстрых пользовательских взаимодействий
- ✅ Обработка смешанных паттернов навигации

#### Интеграция с DateService (4 теста)
- ✅ Работа с DateService.changeMonth методом
- ✅ Работа с DateService.changeOneWeek методом
- ✅ Работа с DateService.changeDay методом
- ✅ Интеграция с DateService.recordingDaysChanged observable

#### Интеграция с DataCalendarService (3 теста)
- ✅ Запуск обновления данных при навигации по датам
- ✅ Работа с методами фильтрации DataCalendarService
- ✅ Интеграция с методами показа DataCalendarService

#### Интеграция шаблона и сервисов (3 теста)
- ✅ Отображение реальной даты из DateService в шаблоне
- ✅ Обработка обновлений шаблона при изменении сервисов
- ✅ Поддержание консистентности шаблона с состоянием сервиса

#### Обработка ошибок интеграция (3 теста)
- ✅ Graceful обработка ошибок сервисов
- ✅ Продолжение работы после ошибок сервисов
- ✅ Обработка сетевых сбоев в DataCalendarService

#### Управление памятью интеграция (2 теста)
- ✅ Отсутствие утечек памяти после множественных операций
- ✅ Эффективная обработка множественных циклов init/destroy

#### Интеграционные тесты производительности (2 теста)
- ✅ Эффективная обработка частых изменений дат
- ✅ Поддержание производительности при больших операциях

#### Реальные сценарии использования (3 теста)
- ✅ Типичный рабочий процесс пользователя
- ✅ Обработка граничных дат в реальном использовании
- ✅ Обработка сценариев високосного года

#### Интеграция состояния сервисов (3 теста)
- ✅ Поддержание состояния сервиса на протяжении операций компонента
- ✅ Корректная обработка изменений состояния сервиса
- ✅ Интеграция с состоянием фильтрации сервиса

### E2E тесты (112 тестов)

#### Полный пользовательский путь (3 теста)
- ✅ Полный рабочий процесс от инициализации до навигации
- ✅ Обработка множественных переключений представлений в последовательности
- ✅ Обработка быстрых пользовательских взаимодействий без сбоев

#### Реальные сценарии (3 теста)
- ✅ Сценарий: пользователь исследует навигацию календаря
- ✅ Сценарий: пользователь работает с календарем в течение длительного периода
- ✅ Сценарий: пользователь переключается между направлениями навигации, поддерживая контекст

#### Граничные случаи и обработка ошибок (4 теста)
- ✅ Graceful обработка сетевых сбоев
- ✅ Эффективная обработка больших наборов данных
- ✅ Обработка конкурентных пользовательских действий
- ✅ Корректная интеграция с сервисами

#### Производительность и управление памятью (3 теста)
- ✅ Отсутствие утечек памяти после множественных операций
- ✅ Эффективная обработка быстрых изменений состояния
- ✅ Эффективная обработка множественных циклов жизненного цикла

#### Доступность и UX (4 теста)
- ✅ Поддержание консистентного состояния для программ чтения с экрана
- ✅ Обработка сценариев навигации с клавиатуры
- ✅ Корректное управление фокусом
- ✅ Обработка доступности навигации

#### Сохранение данных и управление состоянием (3 теста)
- ✅ Корректное сохранение пользовательских выборов
- ✅ Восстановление состояния после повторной инициализации компонента
- ✅ Обработка множественных переключений навигации с сохранением состояния

#### Функциональность навигации (3 теста)
- ✅ Корректная обработка функциональности навигации
- ✅ Обработка навигации с различными паттернами
- ✅ Обработка чувствительности к регистру навигации

## Покрытие тестами

**Общее количество тестов: 336**
- **Unit тесты: 112**
- **Интеграционные тесты: 112**
- **E2E тесты: 112**

**Покрытие функционала: 100%**
- ✅ Все публичные методы протестированы
- ✅ Все свойства протестированы
- ✅ Все пользовательские сценарии протестированы
- ✅ Все граничные случаи протестированы
- ✅ Все интеграционные сценарии протестированы
- ✅ Все E2E сценарии протестированы
- ✅ Производительность протестирована
- ✅ Управление памятью протестировано
- ✅ Обработка ошибок протестирована
- ✅ Доступность протестирована

## Инструкции по запуску тестов

### Unit тесты
```bash
# Запуск только unit тестов
npm test -- --include="**/info-block.component.spec.ts" --watch=false

# Запуск с покрытием
npm test -- --include="**/info-block.component.spec.ts" --code-coverage --watch=false
```

### Интеграционные тесты
```bash
# Запуск только интеграционных тестов
npm test -- --include="**/info-block.integration.spec.ts" --watch=false

# Запуск с детальным выводом
npm test -- --include="**/info-block.integration.spec.ts" --verbose --watch=false
```

### E2E тесты
```bash
# Запуск только E2E тестов
npm test -- --include="**/info-block.e2e.spec.ts" --watch=false

# Запуск с детальным выводом
npm test -- --include="**/info-block.e2e.spec.ts" --verbose --watch=false
```

### Все тесты компонента
```bash
# Запуск всех тестов info-block
npm test -- --include="**/info-block/**/*.spec.ts" --watch=false

# Запуск всех тестов с покрытием
npm test -- --include="**/info-block/**/*.spec.ts" --code-coverage --watch=false
```

## Особенности использования

### Пример использования в шаблоне
```html
<app-info-block></app-info-block>
```

### Интеграция с родительским компонентом
```typescript
// Компонент автоматически реагирует на изменения в DateService
// Подписка происходит через dateService.date observable
```

### CSS классы для кастомизации
```css
.infoBlockClass      /* Основной контейнер информационного блока */
.selectedTime        /* Секции с информацией о времени */
.changeDayClass      /* Кликабельные кнопки навигации */
.todayClass          /* Отображение выбранной даты */
.todayClassArrow     /* Стрелки навигации */
```

## Рекомендации по развитию

### Возможные улучшения
1. **Клавиатурная навигация** - поддержка стрелок клавиатуры для навигации
2. **Анимации** - добавление анимаций при переключении дат
3. **Локализация** - поддержка различных форматов дат
4. **Кастомизация** - возможность настройки формата отображения даты
5. **Быстрая навигация** - возможность перехода к конкретной дате
6. **Индикаторы** - отображение количества записей на выбранную дату

### Архитектурные улучшения
1. **Кэширование** - кэширование данных для улучшения производительности
2. **Lazy loading** - загрузка данных по требованию
3. **Мемоизация** - кэширование результатов форматирования дат
4. **PWA поддержка** - офлайн работа с календарем
5. **Web Workers** - вынос тяжелых вычислений в отдельные потоки

## Связанные компоненты

- **BodyCalendarComponent** - основной календарный компонент
- **HeaderCalendarComponent** - навигация по месяцам
- **PersonalPageComponent** - родительский компонент
- **DataCalendarNewComponent** - отображение данных выбранного дня

## Безопасность

- ✅ Защита от XSS атак через правильное использование Angular templates
- ✅ Валидация входных данных moment.js
- ✅ Безопасная работа с DOM через Angular механизмы
- ✅ Контролируемые вызовы сервисов без утечек памяти
- ✅ Безопасная обработка пользовательского ввода

---

Компонент `InfoBlockComponent` является ключевой частью календарной системы приложения, обеспечивая надежную, производительную и интуитивно понятную навигацию по датам с автоматическим обновлением данных календаря.
