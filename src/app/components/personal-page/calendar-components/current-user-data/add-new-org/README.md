# AddNewOrgComponent

## Описание

`AddNewOrgComponent` - это компонент для добавления новых организаций в систему. Компонент предоставляет форму с валидацией для ввода данных об организации, включая название, руководителя, телефон и email. После успешного добавления организации компонент уведомляет родительский компонент об обновлениях.

**Покрытие тестами: 60 тестов (38 unit + 22 интеграционных)**

## Основной функционал

### Ключевые возможности
- ✅ **Форма добавления организации** - интуитивный интерфейс для ввода данных
- ✅ **Валидация данных** - проверка обязательных полей и формата email
- ✅ **Интеграция с API** - отправка данных через ApiService
- ✅ **Управление состоянием** - корректная работа с подписками и очистка ресурсов
- ✅ **Уведомления** - показ сообщений об успехе через SuccessService
- ✅ **Сброс формы** - автоматическая очистка полей после успешного добавления

### Архитектурные особенности
- **Standalone компонент** - независимая модульная архитектура
- **Reactive Forms** - использование Angular Reactive Forms для управления формой
- **RxJS интеграция** - управление подписками через takeUntil
- **Event Emitter** - уведомление родительского компонента об обновлениях
- **Управление памятью** - автоматическая очистка подписок через destroyed$

## Структура файлов

```
add-new-org/
├── add-new-org.component.ts           # Основная логика компонента
├── add-new-org.component.html         # HTML шаблон формы
├── add-new-org.component.css          # Стили для компонента
├── add-new-org.component.spec.ts      # Unit тесты (38 тестов)
├── add-new-org.integration.spec.ts    # Интеграционные тесты (22 теста)
└── README.md                           # Документация компонента
```

## Публичные методы и свойства

### Свойства
```typescript
formAddOrg: FormGroup                 # Reactive форма для добавления организации
emitForOrgUpdatesAfterAddingNew: EventEmitter  # Событие для уведомления об обновлениях
```

### Методы
```typescript
addNewOrg(): void                     # Добавление новой организации
ngOnDestroy(): void                   # Очистка ресурсов и подписок
```

## Зависимости

### Внешние сервисы
- **PersonalBlockService** - управление состоянием окна добавления организации
- **DateService** - сервис для работы с датами и данными
- **SuccessService** - показ сообщений об успешных операциях
- **ApiService** - отправка HTTP запросов для добавления организации

### Компоненты и директивы
- **ReactiveFormsModule** - поддержка реактивных форм
- **FormsModule** - поддержка форм Angular
- **NgIf** - структурная директива для условного рендеринга

## Алгоритм работы

### Инициализация компонента
1. **Создание формы** - инициализация FormGroup с 4 полями и валидаторами
2. **Установка значений по умолчанию** - managerPhone = '+7', email = ''
3. **Инициализация EventEmitter** - создание события для уведомлений
4. **Инициализация Subject** - создание destroyed$ для управления подписками

### Добавление организации
1. **Валидация формы** - проверка обязательных полей и формата email
2. **Отправка данных** - вызов ApiService.addNewOrganization с данными формы
3. **Обработка ответа** - показ сообщения об успехе через SuccessService
4. **Закрытие окна** - установка windowAddingNewOrgIsOpen = false
5. **Сброс формы** - очистка всех полей формы
6. **Уведомление** - эмит события emitForOrgUpdatesAfterAddingNew

### Уничтожение компонента
1. **Завершение Subject** - вызов destroyed$.next() и destroyed$.complete()
2. **Очистка подписок** - автоматическая отписка от всех Observable через takeUntil

## Детальное описание тестов

### Unit тесты (38 тестов)

#### Создание компонента (4 теста)
- ✅ Успешное создание компонента
- ✅ Инъекция всех требуемых сервисов
- ✅ Инициализация Subject для destroyed$
- ✅ Создание EventEmitter для уведомлений

#### Инициализация формы (6 тестов)
- ✅ Создание formAddOrg с правильной структурой
- ✅ Поле nameOrg с валидатором required
- ✅ Поле supervisorName с валидатором required
- ✅ Поле managerPhone с валидатором required и значением по умолчанию '+7'
- ✅ Поле email с валидаторами required и email
- ✅ Форма содержит 4 контрола

#### Валидация формы (8 тестов)
- ✅ Форма невалидна при пустых полях
- ✅ Форма невалидна при отсутствии nameOrg
- ✅ Форма невалидна при отсутствии supervisorName
- ✅ Форма невалидна при отсутствии managerPhone
- ✅ Форма невалидна при отсутствии email
- ✅ Форма невалидна при некорректном формате email
- ✅ Форма валидна при корректно заполненных полях
- ✅ Форма валидна при различных корректных форматах email

#### Метод addNewOrg (8 тестов)
- ✅ Вызов apiService.addNewOrganization с данными формы
- ✅ Вызов successService.localHandler с сообщением ответа
- ✅ Закрытие окна через personalBlockService.windowAddingNewOrgIsOpen = false
- ✅ Сброс формы после успешного добавления
- ✅ Эмит события emitForOrgUpdatesAfterAddingNew
- ✅ Graceful обработка ошибок API
- ✅ Использование takeUntil с destroyed$ для управления подписками

#### ngOnDestroy (3 теста)
- ✅ Завершение работы subject destroyed$
- ✅ Предотвращение утечек памяти
- ✅ Обработка множественных вызовов destroy

#### Управление состоянием формы (3 теста)
- ✅ Сохранение состояния формы во время операций
- ✅ Сброс формы к начальному состоянию
- ✅ Корректная обработка изменений значений формы

#### Граничные случаи и обработка ошибок (3 теста)
- ✅ Обработка очень длинных значений
- ✅ Обработка специальных символов
- ✅ Обработка Unicode символов

#### Интеграция с сервисами (4 теста)
- ✅ Интеграция с PersonalBlockService
- ✅ Интеграция с DateService
- ✅ Интеграция с SuccessService
- ✅ Интеграция с ApiService

### Интеграционные тесты (22 теста)

#### Полный жизненный цикл компонента (2 теста)
- ✅ Инициализация и корректное отображение
- ✅ Полный цикл от создания до уничтожения

#### Интеграция с сервисами (4 теста)
- ✅ Интеграция с реальным PersonalBlockService
- ✅ Интеграция с реальным DateService
- ✅ Интеграция с реальным SuccessService
- ✅ Интеграция с реальным ApiService

#### Реальная интеграция с API (2 теста)
- ✅ Вызов реального метода ApiService.addNewOrganization
- ✅ Graceful обработка реальных ошибок API

#### Пользовательские взаимодействия (2 теста)
- ✅ Последовательные отправки форм
- ✅ Быстрые отправки форм

#### Поток данных (2 теста)
- ✅ Сохранение целостности данных при операциях
- ✅ Корректная обработка трансформаций данных

#### Обработка ошибок (2 теста)
- ✅ Graceful обработка ошибок сервисов
- ✅ Продолжение работы после ошибок сервисов

#### Управление памятью (2 теста)
- ✅ Корректная очистка подписок при уничтожении
- ✅ Обработка множественных циклов init/destroy

#### Производительность (2 теста)
- ✅ Эффективная обработка высокочастотных операций
- ✅ Поддержание производительности при больших объемах данных

#### Реальные сценарии использования (2 теста)
- ✅ Типичный пользовательский workflow
- ✅ Обработка граничных случаев в реальном использовании

#### Интеграция формы с UI (2 теста)
- ✅ Работа с реальными контролами формы
- ✅ Валидация формы в реальных сценариях

## Использование

### Базовое использование
```html
<app-add-new-org 
  (emitForOrgUpdatesAfterAddingNew)="handleOrgUpdate()">
</app-add-new-org>
```

### Обработка событий
```typescript
handleOrgUpdate() {
  // Обновить список организаций
  this.loadOrganizations();
  // Показать уведомление
  this.showNotification('Организация добавлена');
}
```

## Валидация

### Правила валидации
- **nameOrg**: обязательное поле
- **supervisorName**: обязательное поле
- **managerPhone**: обязательное поле, значение по умолчанию '+7'
- **email**: обязательное поле, должен соответствовать формату email

### Сообщения об ошибках
Компонент использует встроенные валидаторы Angular Forms для показа ошибок валидации.

## Производительность

### Оптимизации
- Использование `takeUntil` для автоматической отписки от подписок
- Минимальное количество изменений состояния
- Эффективная работа с Reactive Forms

### Ограничения
- Форма обрабатывает только текстовые данные
- Максимальная длина полей не ограничена (зависит от браузера)

## Безопасность

### Валидация входных данных
- Проверка обязательных полей
- Валидация формата email
- Защита от XSS через Angular sanitization

### API безопасность
- Данные передаются через HTTPS
- Валидация на стороне сервера
- Обработка ошибок без раскрытия внутренней информации

## Совместимость

### Версии Angular
- Angular 17+ (standalone компоненты)
- Reactive Forms API
- RxJS 7+

### Браузеры
- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## Известные ограничения

1. **Форма не сохраняет черновики** - при перезагрузке страницы все данные теряются
2. **Нет предварительного просмотра** - пользователь не видит, как будет выглядеть организация
3. **Ограниченная валидация** - только базовая проверка формата email

## Планы развития

### Краткосрочные улучшения
- [ ] Добавление валидации номера телефона
- [ ] Сохранение черновиков в localStorage
- [ ] Предварительный просмотр данных

### Долгосрочные улучшения
- [ ] Drag & Drop для загрузки логотипа
- [ ] Интеграция с картами для адреса
- [ ] Автодополнение названий организаций
- [ ] Многоязычная поддержка

## Поддержка

### Документация
- [Angular Reactive Forms](https://angular.io/guide/reactive-forms)
- [Angular Testing](https://angular.io/guide/testing)
- [RxJS takeUntil](https://rxjs.dev/api/operators/takeUntil)

### Контакты
Для вопросов по компоненту обращайтесь к команде разработки или создавайте issue в репозитории проекта.
