# Error Modal Component

## Описание

`ErrorModalComponent` - это компонент модального окна для отображения ошибок пользователю. Компонент автоматически отображается при возникновении ошибки и предоставляет пользователю возможность закрыть его.

## Функциональность

### Основные возможности
- **Автоматическое отображение**: Модальное окно появляется автоматически при получении ошибки через `ErrorResponseService`
- **Отображение ошибок**: Показывает заголовок "Ошибка!" и текст ошибки
- **Кнопка закрытия**: Пользователь может закрыть модальное окно нажатием кнопки "ok"
- **Автоматическое скрытие**: Модальное окно скрывается при очистке ошибки

### Логика работы
1. Компонент подписывается на `errorResponseService.error$` Observable
2. При получении ошибки модальное окно отображается с помощью `*ngIf="errorResponseService.error$ | async as error"`
3. При нажатии кнопки "ok" вызывается метод `closeErr()`, который:
   - Очищает ошибку через `errorResponseService.clear()`
   - Закрывает модальные окна регистрации и восстановления пароля

## Структура компонента

### HTML шаблон
```html
<div class="modalErrorClass" *ngIf="errorResponseService.error$ | async as error">
  <div class="titleErrModal">{{errMessage}}</div>
  <div class="errMessage">
    <span>{{error}}</span>
  </div>
  <div class="btnErrModal">
    <button type="button" class="btnErrModal" (click)="closeErr()">ok</button>
  </div>
</div>
```

### CSS стили
- **`.modalErrorClass`**: Основной контейнер модального окна с красным фоном
- **`.titleErrModal`**: Заголовок ошибки с центрированием
- **`.errMessage`**: Контейнер для текста ошибки
- **`.btnErrModal`**: Стили для кнопки закрытия

### Адаптивность
- На экранах меньше 500px максимальная ширина модального окна составляет 90%
- На больших экранах максимальная ширина составляет 92%

## Зависимости

### Сервисы
- **`ErrorResponseService`**: Предоставляет Observable для ошибок и методы для их очистки
- **`ModalService`**: Управляет состоянием различных модальных окон

### Angular модули
- `AsyncPipe`: Для работы с асинхронными данными
- `NgIf`: Для условного отображения модального окна

## Использование

### В шаблоне
```html
<app-error-modal></app-error-modal>
```

### В компоненте
```typescript
import { ErrorModalComponent } from './error-modal.component';

@Component({
  // ... конфигурация компонента
})
export class ParentComponent {
  // Компонент работает автоматически при наличии ErrorResponseService
}
```

## Тестирование

### E2E тесты
Компонент покрыт комплексными E2E тестами, которые проверяют:

#### Пользовательские сценарии
- Отображение модального окна при возникновении ошибки
- Полный цикл работы: ошибка → чтение → закрытие
- Обработка множественных ошибок

#### Пользовательские взаимодействия
- Клики по кнопке закрытия
- Взаимодействие со всеми элементами модального окна
- Быстрые повторные клики

#### Сценарии ошибок
- Обработка пустых сообщений об ошибках
- Обработка очень длинных сообщений
- Обработка специальных символов

#### Интеграция с сервисами
- Корректная работа с ErrorResponseService
- Корректная работа с ModalService
- Обработка сбоев сервисов

#### Производительность
- Быстрая смена сообщений об ошибках
- Производительность при быстрых кликах

#### Доступность
- Навигация с клавиатуры
- Правильные атрибуты кнопок
- Контрастность и читаемость

#### Адаптивность
- Работа на разных размерах экрана
- Корректная обработка CSS медиа-запросов

### Запуск тестов
```bash
npm test -- --include="**/error-modal.e2e.spec.ts" --watch=false
```

## Особенности реализации

### Условное отображение
Модальное окно отображается только при наличии ошибки благодаря директиве `*ngIf="errorResponseService.error$ | async as error"`. Это обеспечивает автоматическое скрытие при отсутствии ошибок.

### Очистка состояния
При закрытии модального окна происходит полная очистка состояния:
- Очищается ошибка в ErrorResponseService
- Закрываются связанные модальные окна (регистрация, восстановление пароля)

### Реактивность
Компонент автоматически реагирует на изменения в ErrorResponseService благодаря использованию AsyncPipe.

## Возможные улучшения

1. **Анимации**: Добавить плавные анимации появления/исчезновения
2. **Типы ошибок**: Различные стили для разных типов ошибок
3. **Автозакрытие**: Автоматическое закрытие через определенное время
4. **Логирование**: Логирование ошибок для отладки
5. **Интернационализация**: Поддержка множественных языков

## Примеры использования

### Отображение ошибки валидации
```typescript
// В сервисе
this.errorResponseService.localHandler('Поле email обязательно для заполнения');
```

### Отображение сетевой ошибки
```typescript
// При ошибке API
this.errorResponseService.handler('Ошибка соединения с сервером');
```

### Очистка ошибки
```typescript
// При успешной операции
this.errorResponseService.clear();
```
