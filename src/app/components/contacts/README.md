# ContactsComponent

## Описание
`ContactsComponent` - интерактивный компонент для связи с поддержкой и отображения контактной информации. Предоставляет пользователям возможность отправить запрос в службу поддержки через форму обратной связи, а также отображает различные способы связи с разработчиками. Компонент включает валидацию формы, обработку состояний и интеграцию с API для отправки сообщений.

## Основная функциональность
- Отображение кнопки для открытия формы обратной связи
- Интерактивная форма с полями для описания проблемы и email
- Валидация формы с отображением ошибок пользователю
- Отправка запросов в службу поддержки через API
- Обработка успешных и неуспешных ответов API
- Отображение контактной информации (телефон, предложения сотрудничества)
- Возможность закрытия формы и модального окна

## Входные параметры
Компонент не принимает входные параметры через `@Input()`.

## Выходные параметры
Компонент не имеет выходных параметров через `@Output()`, но взаимодействует с сервисами:
- `ModalService` - для управления модальными окнами
- `SuccessService` - для отображения сообщений об успехе
- `ApiService` - для отправки данных на сервер

## Зависимости
### Angular модули
- `ReactiveFormsModule` - для работы с реактивными формами
- `NgIf` - для условного отображения элементов

### Сервисы
- `ApiService` - для отправки запросов в поддержку
- `ModalService` - для управления состоянием модальных окон
- `SuccessService` - для обработки успешных операций

## Свойства компонента
### Публичные свойства
- `openSupport: boolean` - флаг для управления видимостью формы поддержки (по умолчанию `false`)
- `form: FormGroup` - реактивная форма с полями `description` и `email`
- `modalService: ModalService` - публичный доступ к сервису модальных окон
- `successService: SuccessService` - публичный доступ к сервису успеха

### Приватные свойства
- `destroyed$: Subject<void>` - Subject для управления отписками при уничтожении компонента
- `apiService: ApiService` - сервис для API запросов

### Геттеры
- `description: FormControl` - геттер для доступа к контролу описания

## Основные методы
- `openSupportBlock()` - переключает состояние видимости формы поддержки
- `cancelSubmit()` - закрывает форму поддержки и включает форму
- `submit()` - отправляет данные формы в службу поддержки
- `ngOnDestroy()` - очищает подписки при уничтожении компонента

## Валидация формы
### Поле description
- **Обязательное поле** (`Validators.required`)
- **Минимальная длина** 15 символов (`Validators.minLength(15)`)
- Отображение ошибок при нарушении валидации

### Поле email
- **Необязательное поле** без валидации
- Предназначено для обратной связи

## Логика работы
1. **Инициализация**: Компонент загружается с закрытой формой поддержки
2. **Открытие формы**: Пользователь нажимает кнопку "написать в поддержку…"
3. **Заполнение формы**: Пользователь заполняет описание (обязательно) и email (необязательно)
4. **Валидация**: Форма проверяется на корректность заполнения
5. **Отправка**: При валидной форме пользователь может отправить запрос
6. **Обработка ответа**: 
   - При успехе: форма сбрасывается, модальное окно закрывается, показывается сообщение об успехе
   - При ошибке: форма остается заблокированной, ошибка логируется в консоль
7. **Закрытие**: Пользователь может закрыть форму кнопкой "Закрыть" или крестиком

## Тестирование
Компонент покрыт тремя типами тестов:

### Unit тесты (`contacts.component.spec.ts`)
- **45 тестов** покрывают все аспекты компонента
- Тестируют создание и инициализацию компонента
- Проверяют работу формы и валидации
- Тестируют методы компонента (`openSupportBlock`, `cancelSubmit`, `submit`)
- Покрывают интеграцию с сервисами (ApiService, ModalService, SuccessService)
- Проверяют обработку ошибок API
- Тестируют жизненный цикл и управление подписками
- Покрывают граничные случаи и различные сценарии ввода
- Тестируют взаимодействие с DOM элементами
- Проверяют состояния формы (enabled/disabled, valid/invalid)

### Интеграционные тесты (`contacts.integration.spec.ts`)
- **30 тестов** проверяют интеграцию компонента с Angular модулями
- Тестируют интеграцию с HttpClientTestingModule и ReactiveFormsModule
- Проверяют интеграцию форм с DOM элементами
- Тестируют взаимодействие с сервисами в контексте Angular DI
- Покрывают валидацию и состояния формы
- Тестируют обработку ошибок и жизненный цикл
- Проверяют реактивность и метаданные компонента
- Тестируют CSS интеграцию и DOM структуру

### E2E тесты (`contacts.e2e.spec.ts`)
- **14 тестов** проверяют полные пользовательские сценарии
- Тестируют полный рабочий процесс: открытие → заполнение → отправка → успех
- Проверяют сценарии с валидацией: неверные данные → исправление → отправка
- Тестируют сценарии отмены: открытие → отмена → повторное открытие
- Покрывают пользовательские взаимодействия с элементами интерфейса
- Тестируют обработку ошибок API и недоступности сервисов
- Проверяют производительность при быстрых взаимодействиях
- Тестируют доступность и навигацию по форме

## Использование
```typescript
<app-contacts></app-contacts>
```

## Структура HTML
```html
<div class="contactsBlock">
  <!-- Заголовок и кнопки управления -->
  <div class="titleContacts" *ngIf="!openSupport">
    <button class="btnContactsSupport">написать в поддержку…</button>
    <button class="btnCloseContacts">×</button>
  </div>

  <!-- Форма поддержки -->
  <form [formGroup]="form" (submit)="submit()">
    <div class="descriptionProblems" *ngIf="openSupport">
      <textarea formControlName="description"></textarea>
      <input type="email" formControlName="email">
      <button type="button" (click)="cancelSubmit()">Закрыть</button>
      <button type="submit">Отправить</button>
    </div>
  </form>

  <!-- Контактная информация -->
  <div class="footerContacts">
    <div>Сотрудничество</div>
    <div>Разработка приложений для вашего бизнеса</div>
    <div>8-916-840-29-27</div>
  </div>
</div>
```

## Стили
Компонент использует CSS файл `contacts.component.css` для стилизации:
- `.contactsBlock` - основной контейнер компонента
- `.titleContacts` - стили для заголовочной секции
- `.btnContactsSupport` - стили для кнопки открытия поддержки
- `.btnCloseContacts` - стили для кнопки закрытия
- `.descriptionProblems` - стили для формы поддержки
- `.textareaClass` - стили для поля описания
- `.errorTextareaMessage` - стили для сообщений об ошибках
- `.footerContacts` - стили для контактной информации

## Интеграция с API
Компонент отправляет данные на endpoint `/api/user/sendInSupport` с payload:
```typescript
{
  description: string,  // Обязательное поле
  email: string | null  // Необязательное поле
}
```

## Обработка ошибок
- **Валидация формы**: Отображение ошибок пользователю в режиме реального времени
- **API ошибки**: Логирование в консоль, форма остается заблокированной
- **Сетевые ошибки**: Обработка через error callback в subscribe

## Управление состоянием
- **openSupport**: Управляет видимостью формы поддержки
- **form.enabled/disabled**: Блокировка формы во время отправки
- **destroyed$**: Управление подписками для предотвращения утечек памяти

## Зависимости Angular
- Angular Core
- Angular Common (NgIf)
- Angular Forms (ReactiveFormsModule)
- RxJS (Subject, takeUntil, Observable)

## Архитектурные особенности
- Standalone компонент (не требует NgModule)
- Реактивные формы с валидацией
- Интеграция с множественными сервисами
- Правильное управление подписками
- Обработка жизненного цикла компонента

## Особенности реализации
- Использование `takeUntil` для автоматической отписки
- Реактивные формы с кастомной валидацией
- Интеграция с Angular DI системой
- Обработка различных состояний UI

## Производительность
- Эффективное управление подписками
- Минимальные DOM манипуляции
- Оптимизированная валидация форм
- Предотвращение утечек памяти

## Безопасность
- Валидация данных на клиенте
- Безопасная передача данных через сервисы
- Обработка и логирование ошибок
- Защита от XSS через Angular санитизацию

## Доступность
- Семантическая HTML структура
- Правильные атрибуты форм
- Логическая последовательность элементов
- Понятные placeholder'ы и сообщения об ошибках

## Технические требования
- Angular 17+ (для поддержки standalone компонентов)
- RxJS для работы с асинхронными операциями
- Поддержка современных браузеров

## Ограничения
- Зависимость от внешних сервисов
- Необходимость интернет-соединения для отправки
- Ограничения валидации только на клиенте

## Рекомендации по использованию
- Размещать в модальных окнах для лучшего UX
- Обеспечить стабильное API соединение
- Регулярно тестировать интеграцию с сервисами
- Мониторить ошибки отправки через логирование

## Планы развития
- Расширенная валидация email поля
- Добавление файловых вложений
- Интеграция с системой тикетов
- Многоязычная поддержка сообщений
- Офлайн режим с очередью отправки
